---
- name: Start VanillaMC
  gather_facts: true
  hosts: all
  tasks:
    - name: Run VanillaMC
      shell:
        cmd: |
          module load java/jdk-17 || true # just in case we are on DAS
          nohup java -javaagent:jolokia-agent-jvm-2.0.3-javaagent.jar -jar minecraft_server-1.20.1.jar nogui &> /dev/null &
          echo $! > vanillamc.pid
        chdir: "{{ wd }}"
    - name: Waiting for server to become ready
      wait_for:
        path: "{{wd}}/logs/latest.log"
        search_regex: 'For help, type "help"'